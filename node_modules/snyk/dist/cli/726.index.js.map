{"version":3,"file":"726.index.js","mappings":"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","sources":["webpack://snyk/./node_modules/inherits/inherits.js","webpack://snyk/./node_modules/inherits/inherits_browser.js","webpack://snyk/./src/cli/commands/describe.ts","webpack://snyk/./src/lib/policy/find-and-load-policy.ts","webpack://snyk/./src/lib/policy/index.ts","webpack://snyk/./src/lib/policy/pluck-policies.ts"],"sourcesContent":["try {\n  var util = require('util');\n  /* istanbul ignore next */\n  if (typeof util.inherits !== 'function') throw '';\n  module.exports = util.inherits;\n} catch (e) {\n  /* istanbul ignore next */\n  module.exports = require('./inherits_browser.js');\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","import { MethodArgs } from '../args';\nimport { processCommandArgs } from './process-command-args';\nimport * as legacyError from '../../lib/errors/legacy-errors';\nimport {\n  driftignoreFromPolicy,\n  parseDriftAnalysisResults,\n  processAnalysis,\n} from '../../lib/iac/drift';\nimport { CustomError } from '../../lib/errors';\nimport { getIacOrgSettings } from './test/iac/local-execution/org-settings/get-iac-org-settings';\nimport { UnsupportedEntitlementCommandError } from './test/iac/local-execution/assert-iac-options-flag';\nimport config from '../../lib/config';\nimport { addIacDriftAnalytics } from './test/iac/local-execution/analytics';\nimport * as analytics from '../../lib/analytics';\nimport { findAndLoadPolicy } from '../../lib/policy';\nimport { DCTL_EXIT_CODES, runDriftCTL } from '../../lib/iac/drift/driftctl';\nimport { IaCErrorCodes } from './test/iac/local-execution/types';\nimport { getErrorStringCode } from './test/iac/local-execution/error-utils';\nimport { DescribeOptions } from '../../lib/iac/types';\nimport { CLI } from '@snyk/error-catalog-nodejs-public';\n\nexport class FlagError extends CustomError {\n  constructor(flag: string) {\n    const msg = `Unsupported flag \"${flag}\" provided. Run snyk iac describe --help for supported flags`;\n    super(msg);\n    this.code = IaCErrorCodes.FlagError;\n    this.strCode = getErrorStringCode(this.code);\n    this.userMessage = msg;\n    this.errorCatalog = new CLI.InvalidFlagOptionError('');\n  }\n}\nexport default async (...args: MethodArgs): Promise<any> => {\n  const { options } = processCommandArgs(...args);\n\n  // Ensure that this describe command can only be runned when using `snyk iac describe`\n  // Avoid `snyk describe` direct usage\n  if (options.iac != true) {\n    return legacyError('describe');\n  }\n\n  if (options['only-managed']) {\n    return Promise.reject(new FlagError('only-managed'));\n  }\n\n  // Ensure that we are allowed to run that command\n  // by checking the entitlement\n  const orgPublicId = options.org ?? config.org;\n  const iacOrgSettings = await getIacOrgSettings(orgPublicId);\n  if (!iacOrgSettings.entitlements?.iacDrift) {\n    throw new UnsupportedEntitlementCommandError('drift', 'iacDrift');\n  }\n\n  const policy = await findAndLoadPolicy(process.cwd(), 'iac', options);\n  const driftIgnore = driftignoreFromPolicy(policy);\n\n  try {\n    const describe = await runDriftCTL({\n      options: { ...options, kind: 'describe' },\n      driftIgnore: driftIgnore,\n    });\n\n    process.exitCode = describe.code;\n\n    analytics.add('is-iac-drift', true);\n    analytics.add('iac-drift-exit-code', describe.code);\n    if (describe.code === DCTL_EXIT_CODES.EXIT_ERROR) {\n      throw new Error();\n    }\n\n    // Parse analysis JSON and add to analytics\n    const analysis = parseDriftAnalysisResults(describe.stdout);\n    addIacDriftAnalytics(analysis, options as DescribeOptions);\n\n    const output = await processAnalysis(options as DescribeOptions, describe);\n    process.stdout.write(output);\n  } catch (e) {\n    return Promise.reject(e);\n  }\n};\n","import * as snykPolicyLib from 'snyk-policy';\nimport * as debugModule from 'debug';\nimport { PackageExpanded } from 'snyk-resolve-deps/dist/types';\n\nimport { pluckPolicies } from '.';\nimport { SupportedPackageManagers } from '../package-managers';\nimport { PolicyOptions } from '../types';\nimport * as analytics from '../analytics';\n\nconst debug = debugModule('snyk');\n\nexport async function findAndLoadPolicy(\n  root: string,\n  scanType: SupportedPackageManagers | 'docker' | 'iac' | 'cpp',\n  options: PolicyOptions,\n  pkg?: PackageExpanded,\n  scannedProjectFolder?: string,\n): Promise<snykPolicyLib.Policy | undefined> {\n  const isDocker = scanType === 'docker';\n  const isNodeProject = ['npm', 'yarn', 'pnpm'].includes(scanType);\n  // monitor\n  let policyLocations: string[] = [\n    options['policy-path'] || scannedProjectFolder || root,\n  ];\n  if (isDocker) {\n    policyLocations = policyLocations.filter((loc) => loc !== root);\n  } else if (isNodeProject) {\n    // TODO: pluckPolicies expects a package.json object to\n    // find and apply policies in node_modules\n    // TODO: fix these types, this is a hack and is not correct\n    policyLocations = policyLocations.concat(\n      pluckPolicies(pkg as unknown as PackageExpanded),\n    );\n  }\n\n  debug('Potential policy locations found:', policyLocations);\n  analytics.add('policies', policyLocations.length);\n  analytics.add('policyLocations', policyLocations);\n\n  if (policyLocations.length === 0) {\n    return;\n  }\n  let policy;\n  try {\n    policy = await snykPolicyLib.load(policyLocations, options);\n  } catch (err) {\n    // note: inline catch, to handle error from .load\n    // if the .snyk file wasn't found, it is fine\n    if (err.code !== 'ENOENT' && err.code !== 'ENOTDIR') {\n      throw err;\n    }\n  }\n  return policy;\n}\n","export { pluckPolicies } from './pluck-policies';\nexport { findAndLoadPolicy } from './find-and-load-policy';\n","const flatten = require('lodash.flatten');\nimport { PackageExpanded } from 'snyk-resolve-deps/dist/types';\n\nexport function pluckPolicies(pkg: PackageExpanded): string[] | string {\n  if (!pkg) {\n    return [];\n  }\n\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore: broken type\n  if (pkg.snyk) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore: broken type\n    return pkg.snyk;\n  }\n\n  if (!pkg.dependencies) {\n    return [];\n  }\n\n  return flatten(\n    Object.keys(pkg.dependencies)\n      .map((name: string) => pluckPolicies(pkg.dependencies[name]))\n      .filter(Boolean),\n  );\n}\n"],"names":[],"sourceRoot":""}